<div class="course-editor">
  <div class="editor-header">
    <div>
      <h1>{{ isEditMode ? 'Edit Course' : 'Create New Course' }}</h1>
      <p class="subtitle">{{ isEditMode ? 'Update course information and curriculum' : 'Add a new course to your platform' }}</p>
    </div>
    <a routerLink="/admin/courses" class="btn-back">
      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M19 12H5M12 19l-7-7 7-7" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
      </svg>
      Back to Courses
    </a>
  </div>

  <div *ngIf="loading" class="loading-state">
    <div class="spinner"></div>
    <p>Loading course...</p>
  </div>

  <form *ngIf="!loading" class="editor-form" (ngSubmit)="save()">
    <!-- Basic Information -->
    <div class="form-section">
      <h3>Basic Information</h3>
      <div class="form-grid">
        <div class="form-group full-width">
          <label for="title">Course Title *</label>
          <input type="text" id="title" [(ngModel)]="form.title" name="title" (input)="onTitleChange()" required>
        </div>

        <div class="form-group full-width">
          <label for="slug">URL Slug *</label>
          <input type="text" id="slug" [(ngModel)]="form.slug" name="slug" required>
          <small>Used in the course URL (e.g., /courses/{{ form.slug || 'url-slug' }})</small>
        </div>

        <div class="form-group full-width">
          <label for="description">Description</label>
          <textarea id="description" [(ngModel)]="form.description" name="description" rows="4"></textarea>
        </div>

        <!-- Course Image Upload -->
        <div class="form-group full-width">
          <label>Course Image</label>
          
          <div class="image-upload-container">
            <!-- Image Preview -->
            <div class="image-preview" *ngIf="imagePreview">
              <img [src]="imagePreview" alt="Course image preview">
              <button type="button" class="btn-remove-image" (click)="removeImage()" title="Remove image">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M18 6L6 18M6 6l12 12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                </svg>
              </button>
            </div>

            <!-- Upload Controls -->
            <div class="upload-controls">
              <input type="file" id="imageFile" accept="image/*" (change)="onFileSelected($event)" #fileInput hidden>
              
              <button type="button" class="btn-choose-file" (click)="fileInput.click()">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4M17 8l-5-5-5 5M12 3v12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                </svg>
                {{ imagePreview ? 'Change Image' : 'Choose Image' }}
              </button>
              
              <button type="button" class="btn-upload-image" *ngIf="selectedFile && isEditMode" 
                      (click)="uploadImage()" [disabled]="uploadingImage">
                <span *ngIf="!uploadingImage">
                  <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                  </svg>
                  Upload Image
                </span>
                <span *ngIf="uploadingImage">Uploading...</span>
              </button>
            </div>

            <small class="upload-note">
              Recommended: 1200x630px (16:9 ratio). Max 5MB. JPG or PNG.
              @if(!isEditMode) {
                <strong>Note: Save the course first before uploading an image.</strong>
              }
            </small>
          </div>
        </div>

        <div class="form-group">
          <label for="kind">Course Type *</label>
          <select id="kind" [(ngModel)]="form.kind" name="kind" required>
            <option value="PRE_RECORDED">Pre-Recorded</option>
            <option value="LIVE">Live</option>
            <option value="BUNDLE">Bundle</option>
          </select>
        </div>

        <div class="form-group">
          <label for="category">Category</label>
          <input type="text" id="category" [(ngModel)]="form.category" name="category" placeholder="e.g., Programming, Marketing">
        </div>

        <div class="form-group">
          <label for="level">Level</label>
          <select id="level" [(ngModel)]="form.level" name="level">
            <option value="BEGINNER">Beginner</option>
            <option value="INTERMEDIATE">Intermediate</option>
            <option value="ADVANCED">Advanced</option>
            <option value="ALL_LEVELS">All Levels</option>
          </select>
        </div>

        <div class="form-group">
          <label for="published">Status</label>
          <select id="published" [(ngModel)]="form.published" name="published">
            <option [ngValue]="false">Draft</option>
            <option [ngValue]="true">Published</option>
          </select>
        </div>
      </div>
    </div>

    <!-- Pricing -->
    <div class="form-section">
      <h3>Pricing</h3>
      <div class="form-grid">
        <div class="form-group">
          <label for="price">Current Price ($) *</label>
          <input type="number" id="price" [(ngModel)]="form.price" name="price" min="0" step="0.01" required>
        </div>

        <div class="form-group">
          <label for="originalPrice">Original Price ($)</label>
          <input type="number" id="originalPrice" [(ngModel)]="form.originalPrice" name="originalPrice" min="0" step="0.01">
          <small>Leave higher than current price to show discount</small>
        </div>
      </div>
    </div>

    <!-- Instructor Information -->
    <div class="form-section">
      <h3>Instructor Information</h3>
      <div class="form-grid">
        <div class="form-group">
          <label for="instructorName">Instructor Name</label>
          <input type="text" id="instructorName" [(ngModel)]="form.instructorName" name="instructorName" placeholder="John Doe">
        </div>

        <div class="form-group">
          <label for="instructorTitle">Instructor Title</label>
          <input type="text" id="instructorTitle" [(ngModel)]="form.instructorTitle" name="instructorTitle" placeholder="Senior Developer">
        </div>

        <div class="form-group full-width">
          <label for="instructorBio">Instructor Bio</label>
          <textarea id="instructorBio" [(ngModel)]="form.instructorBio" name="instructorBio" rows="3"></textarea>
        </div>
      </div>
    </div>

    <!-- Course Details -->
    <div class="form-section">
      <h3>Course Details</h3>
      <div class="form-grid">
        <div class="form-group">
          <label for="durationHours">Duration (hours)</label>
          <input type="number" id="durationHours" [(ngModel)]="form.durationHours" name="durationHours" min="0">
        </div>

        <div class="form-group" *ngIf="form.kind === 'LIVE'">
          <label for="sessionCount">Number of Sessions</label>
          <input type="number" id="sessionCount" [(ngModel)]="form.sessionCount" name="sessionCount" min="0">
        </div>

        <div class="form-group" *ngIf="form.kind === 'LIVE'">
          <label for="maxStudents">Max Students</label>
          <input type="number" id="maxStudents" [(ngModel)]="form.maxStudents" name="maxStudents" min="1">
        </div>

        <div class="form-group" *ngIf="form.kind === 'LIVE'">
          <label for="startDate">Start Date & Time</label>
          <input type="datetime-local" id="startDate" [(ngModel)]="form.startDate" name="startDate">
          <small>When the course starts</small>
        </div>

        <div class="form-group" *ngIf="form.kind === 'LIVE'">
          <label for="endDate">End Date & Time</label>
          <input type="datetime-local" id="endDate" [(ngModel)]="form.endDate" name="endDate">
          <small>When the course ends</small>
        </div>
      </div>
    </div>

    <!-- Form Actions -->
    <div class="form-actions">
      <a routerLink="/admin/courses" class="btn-cancel">Cancel</a>
      <button type="submit" class="btn-save" [disabled]="saving">
        <span *ngIf="!saving">{{ isEditMode ? 'Update Course' : 'Create Course' }}</span>
        <span *ngIf="saving">Saving...</span>
      </button>
    </div>
  </form>

  <!-- Curriculum Editor (only in edit mode) -->
  <div *ngIf="isEditMode && courseId && !loading" class="curriculum-section">
    <div class="section-header">
      <h3>Curriculum</h3>
      <a [routerLink]="['/admin/courses', courseId, 'curriculum']" class="btn-edit-curriculum">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7" stroke="currentColor" stroke-width="2"/>
          <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z" stroke="currentColor" stroke-width="2"/>
        </svg>
        Edit Curriculum
      </a>
    </div>
    <p class="curriculum-note">Create and manage sections, lessons, quizzes, and exercises for this course.</p>
  </div>
</div>

