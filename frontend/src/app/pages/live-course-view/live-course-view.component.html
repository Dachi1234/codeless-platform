<div class="live-course-view">
  <!-- Header -->
  <div class="course-header">
    <div class="header-content">
      <button class="btn-back" routerLink="/dashboard">â† Back to Dashboard</button>
      <h1>{{course?.title}}</h1>
      <p class="instructor">with {{course?.instructorName}}, {{course?.instructorTitle}}</p>
    </div>
  </div>

  <!-- Tabs -->
  <div class="tabs">
    <button 
      class="tab" 
      [class.active]="activeTab === 'schedule'"
      (click)="switchTab('schedule')">
      ğŸ“… Schedule
    </button>
    <button 
      class="tab" 
      [class.active]="activeTab === 'assignments'"
      (click)="switchTab('assignments')">
      ğŸ“ Assignments
    </button>
  </div>

  <!-- Schedule Tab -->
  <div *ngIf="activeTab === 'schedule'" class="tab-content">
    <div *ngIf="loadingSessions" class="loading">Loading sessions...</div>

    <div *ngIf="!loadingSessions && sessions.length === 0" class="empty-state">
      <p>ğŸ“… No sessions scheduled yet</p>
      <small>Check back later for upcoming live sessions</small>
    </div>

    <!-- Upcoming Sessions -->
    <div *ngIf="upcomingSessions.length > 0" class="sessions-section">
      <h2>ğŸ”œ Upcoming Sessions</h2>
      <div class="sessions-list">
        <div *ngFor="let session of upcomingSessions" class="session-card upcoming">
          <div class="session-header">
            <div class="session-number">Session {{session.sessionNumber}}</div>
            <span class="status-badge" [ngClass]="getStatusBadgeClass(session.status)">
              {{session.status}}
            </span>
          </div>

          <h3>{{session.title}}</h3>
          <p class="session-description" *ngIf="session.description">{{session.description}}</p>

          <div class="session-details">
            <div class="detail-item">
              <span class="icon">ğŸ“…</span>
              <div>
                <strong>{{formatDateTime(session.scheduledAt)}}</strong>
                <small *ngIf="isUpcoming(session.scheduledAt)" class="starting-soon">Starting soon!</small>
              </div>
            </div>
            <div class="detail-item">
              <span class="icon">â±ï¸</span>
              <span>{{session.durationMinutes}} minutes</span>
            </div>
          </div>

          <div class="session-actions">
            <a [href]="session.zoomLink" target="_blank" class="btn-join" *ngIf="session.status === 'LIVE'">
              ğŸ¥ Join Live Session
            </a>
            <a [href]="session.zoomLink" target="_blank" class="btn-zoom" *ngIf="session.status === 'SCHEDULED'">
              ğŸ”— Zoom Link
            </a>
          </div>

          <!-- Materials (if any) -->
          <div *ngIf="materials.get(session.id)?.length! > 0" class="materials">
            <h4>ğŸ“ Materials</h4>
            <div class="materials-list">
              <a *ngFor="let material of materials.get(session.id)" 
                 [href]="material.fileUrl" 
                 target="_blank" 
                 class="material-item">
                <span class="file-icon">{{getFileIcon(material.fileType)}}</span>
                <span class="file-name">{{material.fileName}}</span>
                <span class="file-size">{{formatFileSize(material.fileSizeKb)}}</span>
              </a>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Past Sessions -->
    <div *ngIf="pastSessions.length > 0" class="sessions-section">
      <h2>ğŸ“š Past Sessions</h2>
      <div class="sessions-list">
        <div *ngFor="let session of pastSessions" class="session-card past">
          <div class="session-header">
            <div class="session-number">Session {{session.sessionNumber}}</div>
            <span class="status-badge" [ngClass]="getStatusBadgeClass(session.status)">
              {{session.status}}
            </span>
          </div>

          <h3>{{session.title}}</h3>

          <div class="session-details">
            <div class="detail-item">
              <span class="icon">ğŸ“…</span>
              <span>{{formatDateTime(session.scheduledAt)}}</span>
            </div>
            <div class="detail-item" *ngIf="session.recordingUrl">
              <span class="icon">ğŸ¥</span>
              <a [href]="session.recordingUrl" target="_blank" class="recording-link">Watch Recording</a>
            </div>
          </div>

          <!-- Materials -->
          <div *ngIf="materials.get(session.id)?.length! > 0" class="materials">
            <h4>ğŸ“ Materials</h4>
            <div class="materials-list">
              <a *ngFor="let material of materials.get(session.id)" 
                 [href]="material.fileUrl" 
                 target="_blank" 
                 class="material-item">
                <span class="file-icon">{{getFileIcon(material.fileType)}}</span>
                <span class="file-name">{{material.fileName}}</span>
                <span class="file-size">{{formatFileSize(material.fileSizeKb)}}</span>
              </a>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Assignments Tab -->
  <div *ngIf="activeTab === 'assignments'" class="tab-content">
    <div *ngIf="loadingAssignments" class="loading">Loading assignments...</div>

    <div *ngIf="!loadingAssignments && assignments.length === 0" class="empty-state">
      <p>ğŸ“ No assignments yet</p>
      <small>Check back later for assignments from your instructor</small>
    </div>

    <div *ngIf="!loadingAssignments && assignments.length > 0" class="assignments-list">
      <div *ngFor="let assignment of assignments" class="assignment-card">
        <div class="assignment-header">
          <h3>{{assignment.title}}</h3>
          <div class="assignment-status">
            <span *ngIf="!assignment.mySubmission && !isOverdue(assignment.dueDate)" class="status-badge status-pending">
              Not Submitted
            </span>
            <span *ngIf="!assignment.mySubmission && isOverdue(assignment.dueDate)" class="status-badge status-overdue">
              âš ï¸ Overdue
            </span>
            <span *ngIf="assignment.mySubmission?.isLate" class="status-badge status-late">
              Late ({{assignment.mySubmission?.daysLate}} days)
            </span>
            <span *ngIf="assignment.mySubmission && !assignment.mySubmission.isLate && assignment.mySubmission.grade === undefined" class="status-badge status-submitted">
              Submitted
            </span>
            <span *ngIf="assignment.mySubmission?.grade !== undefined" class="status-badge status-graded">
              Graded
            </span>
          </div>
        </div>

        <p class="assignment-description">{{assignment.description}}</p>

        <div class="assignment-details">
          <div class="detail-row">
            <span class="label">ğŸ“… Due Date:</span>
            <span [class.overdue]="isOverdue(assignment.dueDate)">
              {{formatDueDate(assignment.dueDate)}}
            </span>
          </div>
          <div class="detail-row">
            <span class="label">ğŸ¯ Max Grade:</span>
            <span>{{assignment.maxGrade}} points</span>
          </div>
          <div class="detail-row">
            <span class="label">ğŸ“ Allowed Types:</span>
            <span class="file-types">{{assignment.allowedFileTypes}}</span>
          </div>
          <div class="detail-row">
            <span class="label">ğŸ“¦ Max File Size:</span>
            <span>{{assignment.maxFileSizeMb}} MB</span>
          </div>
        </div>

        <!-- My Submission -->
        <div *ngIf="assignment.mySubmission" class="my-submission">
          <h4>âœ… Your Submission</h4>
          <div class="submission-info">
            <a [href]="assignment.mySubmission.fileUrl" target="_blank" class="file-link">
              ğŸ“ {{assignment.mySubmission.fileName}}
            </a>
            <small>Submitted: {{formatDateTime(assignment.mySubmission.submittedAt)}}</small>
            <small *ngIf="assignment.mySubmission.isLate" class="late-warning">
              âš ï¸ Submitted {{assignment.mySubmission.daysLate}} days late
            </small>
          </div>

          <!-- Grade -->
          <div *ngIf="assignment.mySubmission.grade !== undefined" class="grade-display">
            <div class="grade-score">
              <strong>Grade: {{assignment.mySubmission.grade}} / {{assignment.maxGrade}}</strong>
              <span class="grade-percentage">({{(assignment.mySubmission.grade / assignment.maxGrade * 100).toFixed(0)}}%)</span>
            </div>
            <div *ngIf="assignment.mySubmission.feedback" class="feedback">
              <strong>Feedback:</strong>
              <p>{{assignment.mySubmission.feedback}}</p>
            </div>
            <small *ngIf="assignment.mySubmission.gradedAt">
              Graded on: {{formatDateTime(assignment.mySubmission.gradedAt)}}
            </small>
          </div>
          <div *ngIf="assignment.mySubmission.grade === undefined" class="pending-grade">
            <p>â³ Waiting for instructor to grade...</p>
          </div>
        </div>

        <!-- Upload Form -->
        <div *ngIf="!assignment.mySubmission" class="upload-form">
          <h4>ğŸ“¤ Submit Your Work</h4>
          <div *ngIf="isOverdue(assignment.dueDate)" class="late-warning-box">
            âš ï¸ This assignment is overdue. You can still submit, but it will be marked as late.
          </div>
          <div class="upload-controls">
            <input 
              type="file" 
              [id]="'assignment-file-' + assignment.id"
              (change)="onFileSelected($event, assignment.id)"
              [accept]="getAcceptedFileTypes(assignment.allowedFileTypes)">
            <button 
              class="btn-submit"
              (click)="submitAssignment(assignment)"
              [disabled]="uploadingFile || selectedAssignmentId !== assignment.id">
              {{ uploadingFile && selectedAssignmentId === assignment.id ? 'Uploading...' : 'Submit Assignment' }}
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

