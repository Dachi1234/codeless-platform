## Codeless – Plan for 2025-10-02

### Snapshot (current)
- Auth: JWT login/register, interceptor, token persistence, `/api/me` working
- Courses: list (paginated), detail, featured; UI aligned with branding
- Enrollments: POST/GET wired; JOIN FETCH + DTO prevents lazy-load issues
- Frontend: My Courses page, Auth Guard, header shows auth state and link

### Risks / items needing attention
- Spring milestone artifacts present in logs; ensure stable Spring Boot 3.3.4 only
- Error response shapes not yet standardized across all endpoints
- JWT secret/expiry from env; refresh-token strategy not set
- CORS should be env-driven and tightened for prod
- Course filters/sort UI not wired to backend filtering

### Prioritized tasks (tomorrow)
1) Stabilize backend dependencies (high)
- Ensure Spring Boot 3.3.4 across project; remove milestone artifacts
- Actions: audit POM, run dependency:tree, align starters; verify build/run
- Done when: clean boot with no milestone libs in logs

2) Enrollments DB constraint (high)
- Add unique index on `enrollments(user_id, course_id)` via Flyway V4
- Keep pre-check in service; DB enforces invariant
- Done when: duplicate inserts rejected by DB and return 409 with JSON error

3) Standard API error envelope (high)
- Unify error shape in `GlobalExceptionHandler` (timestamp, status, error, message, path)
- Ensure controllers return JSON errors (no plain strings)
- Frontend: ensure it reads `message` consistently

4) JWT hardening (high)
- Move signing key to env; set expiry and clock skew
- Add refresh-token skeleton (endpoint + storage model, no UI yet)
- Document rotation steps

5) CORS tightening (medium)
- Read allowed origins from env; dev=localhost:4200; prod=site domain(s)
- Disable `*` patterns; verify with Angular dev server via proxy

6) Enrollment existence endpoint (medium, perf)
- Add `GET /api/enrollments/exists?courseId=` → `{ exists: boolean }`
- Use `existsByUserIdAndCourseId` (constant time)
- Frontend: course detail checks this endpoint instead of fetching all

7) Courses filtering/sort (medium)
- Backend: support `q`, `kind`, `level`, `sort` via JPA Specifications or simple criteria
- Frontend: wire search/filters/sort to query params; show total count

8) My Courses UX (medium)
- Link cards to course detail; show simple progress placeholder
- Optional: add empty-state CTA refinement

9) Swagger/OpenAPI (low)
- Confirm `/swagger-ui/index.html` accessible; add security scheme for Bearer
- Add operation summaries/descriptions

10) Dev ergonomics (low)
- Add Windows scripts: `scripts/start-backend.ps1`, `scripts/start-frontend.ps1`
- README updates for one-command start and env setup

### Manual test checklist (after changes)
- Auth: register/login/logout, token persists, `/api/me` returns user
- Courses: list paginates; filters/sort apply; detail loads
- Enrollments: enroll success; duplicate returns 409 with JSON `{ message }`
- My Courses: shows enrolled items with course data; navigates to detail
- CORS: dev works via proxy; prod origins restricted
- Swagger: loads, shows secured endpoints with Bearer auth

### Notes
- Keep returning DTOs from controllers; avoid exposing JPA entities
- Consider projections for list endpoints to avoid broad JOIN FETCH on large data
- Money fields remain `BigDecimal` and consistent with DB numeric types

